define(["jquery","core/ajax"],function(b,a){return{toggle:function(e,d){var c=b("#local_courseexpiry_"+e+" tr-"+e+"-"+d+" a");b(c).find("i").css("color","lightgray");var f=c.hasClass("status-0")?1:0;a.call([{methodname:"local_courseexpiry_toggle",args:{courseid:d,setto:f},done:function(g){if(typeof g.courseid!=="undefined"&&g.courseid==d){if(g.status==1){b(c).empty().append(b('<i class="fa fa-check" style="color: darkgreen;"></i>'))}else{b(c).empty().append(b('<i class="fa fa-exclamation" style="color: red;"></i>'))}}},fail:NOTIFICATION.exception}])},requestId:0,debug:3,confirmed:function(c,f,e){var d="local_eduvidual_"+((f)?"stored":"failed");if(typeof e==="undefined"||e==0){e=1000}console.log("MAIN.confirmed(selector, success, timeout)",c,f,e);b(c).addClass(d);setTimeout(function(){b(c).removeClass(d)},e)},connect:function(d,e){if(this.debug>0){console.log("MAIN.connect(data, payload)",d,e)}var f={data:d,payload:e,requestId:this.requestId++};var c=this;c.signal(f.payload,true);c.spinnerGrid(true);b.ajax({url:URL.fileUrl("/local/eduvidual/ajax/ajax.php",""),method:"POST",data:d,}).done(function(g){try{g=JSON.parse(g)}catch(h){}f.result=g;if(typeof f.result!=="undefined"&&typeof f.result.status!=="undefined"){c.signal(f.payload,false,(f.result.status=="ok"))}if(c.debug>2){console.log("< RequestId #"+f.requestId,f)}c.result(f)}).fail(function(g,h){c.signal(f.payload,false,false);f.textStatus=h;if(c.debug>2){console.error("* RequestId #"+f.requestId,f)}}).always(function(){c.spinnerGrid(false)})},doLogout:function(){var c=localStorage.getItem("local_eduvidual_originallocation");if(c==null){c=""}top.location.href=URL.fileUrl("/local/eduvidual/pages/login_app.php","")+"?dologout=1&originallocation="+encodeURI(c)},navigate:function(c){if(c.indexOf("#")==0){return}var d=this;require(["local_eduvidual/user"],function(e){e.toggleSubmenu(false)});d.spinnerGrid(true);console.log("Normal navigate to ",c);location.href=c;return false},result:function(d){if(typeof d.result.error!=="undefined"&&d.result.error!=""){console.log(d.result.error);STR.get_strings([{key:"confirm",component:"core"},{key:d.result.error,component:"local_eduvidual"},]).done(function(e){NOTIFICATION.alert(e[1],e[0])}).fail(NOTIFICATION.exception)}var c=d.data.module;if(c=="manage"){c="manager"}require(["local_eduvidual/"+c],function(e){e.result(d)})},popPage:function(d,e){if(typeof e==="undefined"){e="?"}var c=URL.fileUrl("/local/eduvidual/pages/"+d+".php",e);console.log("popPage ",c);b.get(c).done(function(f){console.log("Got body ",f);ModalFactory.create({title:"",body:f,}).done(function(g){console.log("Created modal");g.show()})}).fail(function(f){console.err("Error",f)})},signal:function(c,e,d){console.log("MAIN.signal(payload, to, success)",c,e,d);if(typeof c!=="undefined"&&typeof c.signalItem!=="undefined"){if(typeof e!=="undefined"&&e){b(c.signalItem).addClass("local_eduvidual_signal")}else{b(c.signalItem).removeClass("local_eduvidual_signal")}if(typeof d!=="undefined"){b(c.signalItem).addClass("local_eduvidual_signal_"+((d)?"success":"error"));setTimeout(function(){b(c.signalItem).removeClass("local_eduvidual_signal_"+((d)?"success":"error"))},1000)}}},spinnerGrid:function(c){if(typeof b(".spinner-grid")==="undefined"||b(".spinner-grid")==null||b(".spinner-grid").length==0){b("body").prepend(b('<div class="spinner-grid"><div /><div /><div /><div /></div>'))}if(typeof c!=="undefined"&&(c=="show"||c==true)){b(".spinner-grid").addClass("show")}else{b(".spinner-grid").removeClass("show")}},toggle:function(e,c,d){if(this.debug>5){console.log("local_eduvidual/main:toggle(uniqid, a, target)",e,c,d)}b("."+e+"-card").addClass("hidden");b(c).closest(".toggle-controller-"+e).find("a").removeClass("active");b("#"+e+"-"+d).removeClass("hidden");b(c).addClass("active")},watchValue:function(d){if(this.debug>5){console.log("MAIN.watchValue(o)",d)}var c=this;if(b(d.target).attr("data-iswatched")!="1"){b(d.target).attr("data-iswatched",1);d.interval=setInterval(function(){if(b(d.target).val()==d.compareto){d.run();clearInterval(d.interval);b(d.target).attr("data-iswatched",0)}else{d.compareto=b(d.target).val()}},1000)}},}});